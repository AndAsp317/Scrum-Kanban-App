<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scrum Kanban Board</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Farbpunkte für Nutzerrollen */
    .role-badge {
      display: inline-block;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      margin-right: 6px;
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <div id="app" class="container py-4">
    <h1 class="mb-4 text-center">🗂️ Scrum Kanban Board</h1>

    <!-- Nutzerverwaltung -->
    <div class="mb-4">
      <h4>Nutzer verwalten</h4>
      <form @submit.prevent="addUser" class="row g-2 align-items-center mb-3">
        <div class="col-md-5">
          <input
            v-model="newUserName"
            type="text"
            class="form-control"
            placeholder="Neues Teammitglied hinzufügen"
            required
          />
        </div>
        <div class="col-md-4">
          <select v-model="newUserRole" class="form-select" required>
            <option disabled value="">Rolle auswählen</option>
            <option value="Product Owner">Product Owner</option>
            <option value="Entwickler">Entwickler</option>
            <option value="Scrum Master">Scrum Master</option>
          </select>
        </div>
        <div class="col-md-3">
          <button class="btn btn-success w-100" type="submit">Hinzufügen</button>
        </div>
      </form>

      <ul class="list-group">
        <li
          v-for="(user, i) in users"
          :key="user.id"
          class="list-group-item d-flex justify-content-between align-items-center"
        >
          <div>
            <span
              class="role-badge"
              :style="{backgroundColor: roleColor(user.role)}"
              :title="user.role"
            ></span>
            {{ user.name }}
          </div>
          <div>
            <button class="btn btn-sm btn-secondary me-2" @click="editUser(i)">✏️</button>
            <button class="btn btn-sm btn-danger" @click="deleteUser(i)">🗑️</button>
          </div>
        </li>
      </ul>
    </div>

    <!-- Aufgabenformular -->
    <form @submit.prevent="addTask" class="mb-4">
      <div class="row g-2 mb-2">
        <div class="col-md-5">
          <label for="taskText" class="form-label">Aufgabe</label>
          <input
            id="taskText"
            v-model="newTaskText"
            type="text"
            class="form-control"
            placeholder="Neue Aufgabe hinzufügen"
            required
          />
        </div>
        <div class="col-md-4">
          <label for="taskUser" class="form-label">Verantwortlicher Nutzer</label>
          <select id="taskUser" v-model="newTaskUser" class="form-select" required>
            <option disabled value="">Bitte wählen</option>
            <option
              v-for="user in users"
              :key="user.id"
              :value="user.name"
            >
              {{ user.name }} ({{ user.role }})
            </option>
          </select>
        </div>
        <div class="col-md-3">
          <label for="taskDeadline" class="form-label">Deadline</label>
          <input id="taskDeadline" v-model="newTaskDeadline" type="date" class="form-control" required />
        </div>
      </div>
      <button class="btn btn-primary" type="submit">Aufgabe hinzufügen</button>
    </form>

    <!-- Kanban-Board -->
    <div class="kanban-board d-flex gap-3 flex-wrap">
      <div
        v-for="status in statuses"
        :key="status"
        class="kanban-column"
        @dragover.prevent
        @drop="dropTask($event, status)"
      >
        <h3>{{ statusLabels[status] }}</h3>
        <ul class="kanban-list">
          <li
            v-for="task in filteredTasks(status)"
            :key="task.id"
            class="kanban-item"
            draggable="true"
            @dragstart="dragStart(task)"
            @dragend="dragEnd"
          >
            <div>
              <strong>{{ task.text }}</strong><br />
              <small>
                <span
                  class="role-badge"
                  :style="{backgroundColor: roleColor(userRoleByName(task.user))}"
                  :title="userRoleByName(task.user)"
                ></span>
                👤 {{ task.user }} | 📅 {{ formatDate(task.deadline) }}
              </small>
            </div>
            <div>
              <button
                class="edit-btn btn btn-link btn-sm"
                @click="editTask(task)"
                title="Bearbeiten"
              >
                ✏️
              </button>
              <button
                class="delete-btn btn btn-link btn-sm text-danger"
                @click="deleteTask(task)"
                title="Löschen"
              >
                🗑️
              </button>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="app.js"></script>
</body>
</html>
